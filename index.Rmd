---
title: "Sustainability on College Campuses across the US"
author: "giRlbosses"
date: "11/18/2021"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: "kate"
    self_contained: false
---

```{r setup, include = FALSE}
library(tidyverse)
library(kableExtra) 
library(janitor)
library(tidytext)
library(wordcloud)
library(textdata)
library(robotstxt) 
library(rvest) 
library(purrr) 
library(readxl)
library(readr)
library(fuzzyjoin)
library(readxl)
library(leaflet)
library(gganimate)
library(transformr)
library(gifski)
library(png)


# Set code chunk defaults 
knitr::opts_chunk$set(echo = FALSE, 
                      mesage = FALSE,
                      warning = FALSE,
                      fig.align = "center")

# Set R environment options
options(knitr.kable.NA = '')
```

# Motivations

Similar to our Shiny project, we wanted to investigate sustainability at Amherst College and expand our study of sustainability to other colleges. Our goal is to assess how Amherst College prioritizes sustainability through their sustainability report and actions to both hold our campus accountable and make cross institutional comparisons. By making these comparisons, we hope to foster cross institutional dialogue to become a more sustainable campus through collaboration with other colleges to inspire our own 

# Sustainability Report Sentiment Analysis

For the sentiment analysis section of our project, I (Gillian) scraped Amherst College's most recent sustainability report from 2017, which can be accessed [here](https://www.amherst.edu/amherst-story/today/green-amherst/reporting-and-operations/sustainability-reports/report-october-2017) through R code. I needed to be able to convert it into a data frame in R, which is why I scraped it. It is a .txt file with one string which I tokenized into words, removed the stop words, and counted the word frequencies to use in my sentiment analysis. We wanted to examine the sentiments found in this report because it will provide insight on how the college's administration discusses issues surrounding sustainability. 

```{r, message = FALSE}
#Read in sustainability report
report <- read_csv("sentimentanalysis/data/amherstsustainabilityreport.txt")

#Stop word data
data(stop_words)

#Wrangling
word_frequencies <- report %>%
  #Tokenize text into words
  unnest_tokens(output = word, input = x) %>%
  #Remove stop words
  anti_join(stop_words, by = "word") %>%
  #Word frequencies
  count(word, sort = TRUE) 
```

## Common Words

First, I created a common words plot that displays the top ten most common words in the report. This plot shows that investment was the most common word in the report, being written 30 times. This is interesting because it shows the institution views investment and money as very important factors when considering sustainability policy. I also created a word cloud that displays words with a minimum frequency of 5 and colors and sizes them from least to most frequent. 

```{r, warning = FALSE}
#Common words plot
word_frequencies %>%
  slice(1:10) %>%
  ggplot(aes(x = reorder(word, n), y = n, 
             color = word, fill = word)) +
  geom_col() +
  coord_flip() +
  guides(color = "none", fill = "none") +
  labs(x = NULL,
       y = "Number of instances",
       title = "The Most Common Words in Amherst's Sustainability Report")

#Word Cloud
mypal <- brewer.pal(10, "Paired")

wordcloud(words = word_frequencies$word, 
          freq = word_frequencies$n,
          min.freq = 5,
          max.words = 50,
          # plot the words in a random order
          random.order = TRUE,
          # specify the range of the size of the words
          scale = c(2, 0.3),
          # specify proportion of words with 90 degree rotation
          rot.per = 0.15,
          # colors words from least to most frequent
          colors = mypal,
          # font family
          family = "sans")
```

## NRC Lexicon

Next, I examined three different lexicons to try and summarize the sentiments in the report. First is the NRC Lexicon which categorizes words by emotions. I created a visualization that displays all of the emotions sorted with the lexicon and the words with the highest contribution to those sentiments. Some notable aspects from this visualization include that the fear emotion included the word change 10 times and the trust and joy emotions included a large variety of words while emotions like sadness and disgust had many less words. This provides some context about how Amherst talks about sustainability coming more from a positive place with change rather than a place of fear or distrust.

```{r, fig.height = 6}
#NRC Lexicon
nrc_lexicon <- get_sentiments("nrc")

nrc_lexicon_formatted <- inner_join(nrc_lexicon, word_frequencies, by = c("word" = "word"))

nrc_graphic <- nrc_lexicon_formatted %>%
  filter(sentiment %in% c("anger", 
                          "anticipation", 
                          "disgust", 
                          "sadness", 
                          "fear", 
                          "joy", 
                          "surprise", 
                          "trust")) %>%
  group_by(sentiment) %>%
  arrange(desc(n)) %>%
  slice(1:10) %>%
  ungroup()

nrc_graphic %>%
  ggplot(aes(x = reorder(word, n), y = n, 
             fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  facet_wrap(~ sentiment, ncol = 2, scales = "free") +
  labs(x = NULL,
       y = "Contribution to sentiment",
       title = "The most common sentiments in Amherst's Sustainability Report, NRC")
```

## AFINN Lexicon

Next, I created a visualization with the AFINN lexicon which looks at negative versus positive words with an integer between 5 and -5. The highest integer on this visualization is 3 with the word sucessful. However, the overall trend shows words with positive integers (positive words) with values between 1 and 2. Therefore, Amherst is talking about sustainability with generally slightly positive terms and very few negative terms. 

```{r, fig.width = 10}
#AFINN Lexicon
afinn_lexicon <- get_sentiments("afinn")

afinn_lexicon_formatted <- inner_join(afinn_lexicon, word_frequencies, by = c("word" = "word"))

ggplot(afinn_lexicon_formatted, aes(x = word, y = value, fill = n)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(x = NULL,
       y = "Contribution to sentiment",
       title = "The most common sentiments in Amherst's Sustainability Report, AFINN") +
        guides(fill = guide_legend(title = "Frequency"))
```

## BING Lexicon
Lastly, I looked at the BING Lexicon which just sorts words into negative or positive and created a visualization that shows the negative and positive words with their frequency. Again, you can see that there are many more positive words than negative words and that the positive words seem to have higher frequencies, with the word sustainability having the highest frequency.

```{r, fig.width = 10, message = FALSE}
#BING Lexicon
bing_words <- word_frequencies %>%
  inner_join(get_sentiments("bing")) %>%
  ungroup() 

ggplot(bing_words, aes(x = word, y = n)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  facet_wrap(vars(sentiment), scales = 'free_x') +
  labs(x = NULL,
       y = "Contribution to sentiment",
       title = "The most common sentiments in Amherst's Sustainability Report, BING") 
```

## Conclusions

The overall conclusion I drew from my sentiment analysis is that Amherst talks about sustainability from an overall positive viewpoint and tries to limit its use of negative words. There are some limitations to this conclusion. First, I only used the sustainability report Amherst published in 2017. Therefore, this is a very limited view into Amherst College's sentiments surrounding sustainability and is outdated, however, there is not a more recent report. Therefore, the population this can be applied to is very limited and the results can not be generalized beyond Amherst College within the last few years. Although the scope of this analysis is small, it is purposeful to pinpoint how the institution of our own college has recently talked about the issue of sustainability. This analysis could be extended by including all past reports, or broadening the scope to include other colleges. 

# Sustainability Degrees Awarded Across Colleges Nationwide as a Proxy for Sustainability

We also wanted to visualize how different universities across the United States prioritize educating their students on sustainability-related disciplines. Therefore, we used data collected by datausa on the amount of Sustainability Studies degrees awarded to students across institutions between 2013-2019 with 1014 total measurements of Sustainability Studies completions across these years. In order to consider differing sizes of the undergraduate class across institutions, these degree completions were divided by 1/4 the number of undergraduate students during Fall 2020 from the National Center for Education Statistics. This ratio was then multiplied by 100 to calculate the percent of Sustainability Studies degrees awarded for each graduating year. We also collected out of state tuition data for these institutions using data from datausa to examine the relationship between sustainability degrees awarded for a given graduating class and the tuition cost. Latitude and longitude data for the institutions was collected using the `colleges` dataset to create the interactive map below.

## Sustainability Studies degree and college tuition map 

```{r, message = FALSE}
#Reading in sustainability studies data
Institutions <- read_csv("data/Institutions.csv")
Tuition <- read_csv("data/Tuition Costs for Common Institutions.csv")
Degrees_by_County <- read_csv("data/Degrees Awarded by County.csv")
Growth_by_County <-  read_csv("data/Growth in Awarded Degrees.csv")
colleges <- read_csv("data/ipeds_directory_info.csv") %>%
  janitor::clean_names() %>%
  rename("institution" = "institution_name")

#Creating joined dataset with tuition and degree completions

joined_uni <- left_join(Tuition, Institutions, by = c("ID University", "Year"))

#Wrangling joined_uni data 
clean_joined_uni <- joined_uni %>%
  janitor::clean_names() %>%
  select(id_university, university_x, year, state_tuition, total_graduates, out_of_state_tuition, sector, completions) %>%
rename("institution" = "university_x")

#Joining tuition and degree completion data with colleges data
fuzzy_uni <- stringdist_left_join(clean_joined_uni, colleges, by = "institution")

#Wrangling joined dataset to prepare for creating map figure
uni_map <- fuzzy_uni %>%
  filter(!institution.x %in% c("Jefferson (Philadelphia University + Thomas Jefferson University)", "Messiah University", "Lyndon State College"))


#Reading in class size data to calculate percent degrees awarded
Summary_Tables <- read_excel("data/Summary Tables.xlsx")

#Wrangling class size data so can join with the enrollment map later
Summary_Tables <- Summary_Tables[-c(1:4),] %>%
  janitor::clean_names() %>%
  rename("institution" = "x2", "id_university" = "national_center_for_education_statistics",
         "enrollment_type" = "x3",
         "total_enrollment" = "x4")

enrollment <- Summary_Tables %>%
  select(institution, id_university, enrollment_type, total_enrollment) %>%
  #just want the undergrad
  filter(enrollment_type == "Undergraduate Enrollment", !total_enrollment == "-") %>%
  mutate(id_university = parse_double(id_university),
         total_enrollment = parse_double(total_enrollment))
#Joining the tuition and completion data with the class size data
enroll_map <- left_join(uni_map, enrollment, by = "id_university") %>%
  #Creating new column to represent the percentage of each graduating class 
  #that receives a Sustainability Studies degree
  mutate(percentdegree = (completions/(total_enrollment/4)*100)) %>%
  filter(!is.na(percentdegree))
  
#Creating color palette
pal <- colorBin(
  palette = 'Dark2',
  domain = enroll_map$percentdegree,
  bins = c(0, .1, .3, .6, .9, 1.1, 1.5, 2, 2.5, 5, 6, 10, 20, 30)
)
#Creating
leaflet(data = enroll_map) %>%
  addTiles() %>%
  addCircleMarkers(lat = ~latitude_location_of_institution_hd2019, lng = ~longitude_location_of_institution_hd2019, popup = ~ paste0("Institution: ", institution.x, " Percent degree completions: ", percentdegree, "%", "\nOut of state tuition: $", out_of_state_tuition), weight = 1,  color=~pal(percentdegree), radius = ~out_of_state_tuition/10000) %>%
  addLegend("bottomright", pal = pal, values = ~percentdegree,
    title = "Percent sustainability degree",
    labFormat = labelFormat(suffix = "%"),
    opacity = 1
  )
```

To investigate the spatial distribution of percent degrees awarded, we created an interactive map with the color of the points indicating the percent of all graduating undergraduate students for a given year between 2013 and 2019 that were awarded the Sustainability Studies degree. The sizes of the points are scaled by the out of state tuition. This plot allows the user to zoom into different colleges to geographically visualize percent degrees awarded and the out of state tuition.

# Relationship between Sustainability Studies degrees awarded and college tuition

We then wanted to explore the relationship between the school's prioritization of the Sustainability Studies department and the out of state tuition. We hypothesized that schools with higher tuition would have higher percent Sustainability Studies degree completions because schools with higher tuition could have the finances to expand their degree options to Sustainability Studies and provide more support and resources in this department.

```{r, message = FALSE}
#creating scatterplot to investigate relationship between percent sustainability and the out of state tuition

ggplot(data = enroll_map, aes(y = log(log(percentdegree + 1)), x = out_of_state_tuition)) +
  geom_point(aes(color = institution.x)) + theme(legend.position = "none") + ggtitle("Transformed percent Sustainability Studies completions\ncompared to out of state tuition in ten thousands of dollars") + xlab("Out of State Tuition (ten thousands of dollars)") + ylab ("Percent Sustainability Studies degree completions")

#filtering out the zeros so can look at trend line

#creating a frequency plot with just the schools that have the most completions equal to zero, so count up how many zeros there were over all of the years

```

Percent completions of the Sustainability Studies degree were transformed in order to visualize the relationship. There appears to be no relationship between the percent completions and the tuition. This suggests that tuition may not affect the school's prioritization of Sustainability Studies and thus may not limit students' access to the Sustainability Studies degree.

# Change in degrees awarded over time

We also wanted to investigate the trend of Sustainability Studies degrees awarded as a proxy of institutions' changing prioritization of educating their students on sustainability over time.

```{r, message = FALSE}
#dynamic histogram to see if the percent sustainability degrees differ over time
#gganimate
#first create different datasets for the different years
enroll2013 <- enroll_map %>%
  filter(year == "2013") %>%
  select(institution.x, year, percentdegree)

enroll2014 <- enroll_map %>%
  filter(year == "2014") %>%
  select(institution.x, year, percentdegree)

enroll2015 <- enroll_map %>%
  filter(year == "2015") %>%
  select(institution.x, year, percentdegree)

enroll2016 <- enroll_map %>%
  filter(year == "2016") %>%
  select(institution.x, year, percentdegree)

enroll2017 <- enroll_map %>%
  filter(year == "2017") %>%
  select(institution.x, year, percentdegree)

enroll2018 <- enroll_map %>%
  filter(year == "2018") %>%
  select(institution.x, year, percentdegree)

enroll2019 <- enroll_map %>%
  filter(year == "2019") %>%
  select(institution.x, year, percentdegree)
enroll_map <- enroll_map %>%
  mutate(year = as.integer(year))
#make sure to adjust the size: want x axis to about 1.5 times the y axis
anim_plot <- ggplot(enroll_map, aes(log(log(percentdegree + 1)))) + geom_density(col = "black",fill = "blue") + ggtitle("{frame_time}") + xlab("percent degree completions") + ylab("frequency") + transition_time(year) + shadow_mark(alpha = .3) + ease_aes("linear") +
  enter_fade() +
  exit_fade()
animate(anim_plot, width = 700, height = 450)

```

Between 2013 and 2019 there appears to be first an increase in the number of schools which documented Sustainability Studies completions, which is most likely because there are less data for 2013 than the other years. Notably, however, the density plot shifts to higher percentages of completions from 2013-2019, which could suggest that institutions are starting to prioritize educating their students on Sustainability-related topics.

# How well do Sustainability Studies completions measure sustainability?

We used data from the EPA which ranked the top most sustainable colleges and universities in terms of the amount of green power they use. Below is a table ranking the top 10 most sustainable colleges as well as a table ranking the top 10 schools with the highest number of Sustainability Studies completions.

# Top 10 schools using the most green power

```{r, message = FALSE}
#comparing the top 30 to the other top 30

#Top 30 in terms of Green Power for 2019
Top30 <- read_excel("data/Top30.xlsx") %>%
  rename("Green Power Proportion of Total Energy Used" = "...4") %>%
  select(Institution, 
         `Green Power (kWh)`,
         `Green Power Proportion of Total Energy Used`) %>%
  slice(1:10)
knitr::kable(Top30)  
```

# Top 10 schools with the most Sustainability Studies degree completions

```{r, message = FALSE}
#Top 30 in terms of percent Sustainability Studies completions
Top30degree <- enroll2019 %>%
  filter(institution.x != "SIT Graduate Institute") %>%
  mutate(percentdegree = round(percentdegree, 2)) %>%
  distinct() %>%
  arrange(desc(percentdegree)) %>%
  slice(1:10) %>%
  select(institution.x, percentdegree) %>%
  rename("Institution" = "institution.x",
         "Percent Sustainability Studies completions" = "percentdegree") 
knitr::kable(Top30degree)

```

There does not appear to be any overlap between the ranked schools in the two tables. This is interesting because it suggests that different schools have different aspects of sustainability to offer.

## Conclusions from Sustainability Studies Degree Analysis

From our analysis of the sustainability studies degrees awarded, the interactive map allows the user to check how a specific school of interest prioritizes Sustainability Studies. Overall, it seems that there is little relationship between sustainability studies degrees awarded and the tuition cost. According to the density plot, there appears to be a rise in sustainability studies degrees awarded, which is exciting! Lastly the Sustainability Studies degree completions does not determine a school's "sustainability" and we need to consider many different factors in order to generate a more comprehensive survey of schools' sustainability.

# STARS Interactive Map

```{r, out.width="100%", out.extra='data-external=1; style="border: none;"'}
 knitr::include_app("https://sazhu24.shinyapps.io/shiny-map/", height = "920px")
```

The Sustainability Tracking, Assessment & Rating System (STARS) was developed as a transparent, comprehensive tool to empower higher education faculty, administrators, staff and students to be effective change agents and drivers of sustainability innovation. The database, which includes reports for more than 500 institutions, provides a comprehensive look into all facets of sustainability and innovation across higher education, while establishing clear benchmarks and measures of accountability. Our project recognizes the unique challenges, constraints, and opportunities facing colleges and universities in the U.S. today, and created this interactive feature with the goal of aiding strategic planning, fostering cross-sector dialogue about sustainability on campus, and stimulating conversations and learning between institutions.  

Our final data set consisted of 275 American institutions after scraping the entire STARS report database and filtering out expired, non-scoring, or non-US based reports. The aggregate scores of each section on the STARS Report Card – Curriculum, Research, Campus Engagement, Public Engagement, Air, Buildings, Energy, Food, Planning, Diversity, Investment, Wellbeing, and a few additional points for Innovation and Leadership – culminate in the total score and overall STARS rating for each institution. The first page of our interactive leaflet map displays the distribution of ratings for institutions across the US. Among all scored institutions in the STARS database, 2.9% are platinum-rated, 36.8% are gold-rated, 46% are silver-rated, and 12.6% are bronze-rated. The map also displays scores for each component of the report card, as well as scraped answers the highest-weighted response items on the STARS report. These range from greenhouse gas emissions and waste produced per weighted campus user, to the percentage of course offerings or current research that focuses on sustainability at each institution. Percentile scores for each institution are mapped to a corresponding color scale on the map, and to bar heights on the plot in the next tab. Operational characteristics including endowment, area, population, climate, and locale are also provided to contextualize each institution's score. A search feature also allows users to highlight institutions of their choosing for easy comparison, while radio buttons enable users to filter for top scoring institutions or for liberal arts colleges bearing similar characteristics to Amherst. 

Our map shows that Amherst lags behind many of its peers across all STARS categories. For example, even after factoring in Amherst's recent announcement of the New England College Renewable Partnership – a joint solar energy facility collectively owned and managed by Amherst, Bowdoin, Hampshire, Smith and Williams that will reduce Amherst's CO2 emissions by "more than 3,200 metric tons per year, or 17.5 percent" – Amherst still places it the top 70% of largest greenhouse gas producers per capita. Among all liberal arts schools in our database, Amherst places even higher, among the top 80% of largest greenhouse gas producers per capita. Amherst scores just as poorly when it comes to sustainability in curriculum, waste production and diversion, energy and water efficiency, ethical/sustainable food-sourcing, and more.

However, as comprehensive as the STARS database may be, the accuracy of cross-institutional comparisons still hinge on the range and accuracy of the self-reported data submitted by each institution. The STARS report allows institutions to submit data from as far back as three years before the report date. Since original report dates can range as far back as 2018 (like Amherst's does), the reported data can be up to 6 years old. The constant evolution the STARS report and rising popularity of sustainability values means newer reports are more likely to reflect accurate information and potentially higher scores. Moreover, since the report is a voluntary self-assessment tool, the map excludes reports for non-participating institutions, expired reports, and those not verified by the STARS assessment board. Although the 275 institutions mapped represent a wide range of higher education institutions, it by nature filters for schools that are actively pursuing the goals outlined by the STARS report. Even some of the most prestigious ivy-league institutions like Harvard, Dartmouth, and Brown University are not participating STARS members. The range in institution and report type also means that some variables only show information from institutions that were able to to report on certain prompts, such as the percentage of food products verified as ethically or sustainably sourced. Thus, any conclusions drawn from cross-institutional comparisons must take these considerationd into account. The interactive map and plot show us that in terms of greenhouse gas emissions per person and other similar metrics, Amherst has tremendous room for growth and a lot to learn from peer institutions with similar operating and geographic characteristics. However, it would not be accurate to say that they lie in the bottom 30th percentile of all institutions in the U.S..

# Future Explorations

For future directions, we want to examine where students from Amherst College and other colleges end up after graduation. Although a student's upbringing before college shapes what they value, we are curious to investigate how schools differ in their students' career trajectories. The number of students who have careers in sustainability after graduation could provide insight into how schools could shape their students' decision to go into sustainability as a career. 

Next year, when we get a new head of the Office of Sustainability, we expect that sustainability data for the college will be more available. When we have access to these new data, we can conduct more analyses such as the school's emissions data. We are looking forward to sharing our findings with the office to hold our campus and ourselves accountable.
